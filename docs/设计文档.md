# 具身智能论文Survey工具 - 设计文档

**文档版本**: v1.0  
**项目名称**: nona - 具身智能论文Survey工具  
**编写日期**: 2024年12月  
**文档状态**: 正式发布

---

## 目录

1. [文档概述](#1-文档概述)
2. [概要设计](#2-概要设计)
   - 2.1 [系统概述](#21-系统概述)
   - 2.2 [系统架构](#22-系统架构)
   - 2.3 [模块划分](#23-模块划分)
   - 2.4 [数据流设计](#24-数据流设计)
   - 2.5 [技术选型](#25-技术选型)
3. [详细设计](#3-详细设计)
   - 3.1 [配置模块](#31-配置模块-configpy)
   - 3.2 [数据库模块](#32-数据库模块-databasepy)
   - 3.3 [论文收集模块](#33-论文收集模块-collectors)
   - 3.4 [信息获取模块](#34-信息获取模块-fetchers)
   - 3.5 [PDF处理模块](#35-pdf处理模块-processors)
   - 3.6 [AI分析模块](#36-ai分析模块-analyzers)
   - 3.7 [脚本模块](#37-脚本模块-scripts)
4. [接口设计](#4-接口设计)
5. [数据库设计](#5-数据库设计)
6. [部署与运维](#6-部署与运维)
7. [附录](#7-附录)

---

## 1. 文档概述

### 1.1 编写目的

本文档是具身智能论文Survey工具的系统设计文档，旨在：
- 描述系统的整体架构和模块划分
- 说明各模块的详细设计和接口规范
- 为开发、测试和维护提供技术参考

### 1.2 项目背景

随着具身智能领域的快速发展，每年发表的相关论文数量急剧增长。为了高效地收集、筛选和分析这些论文，开发了本自动化Survey工具，支持从多个学术来源自动收集论文，并使用大语言模型进行相关性分析。

### 1.3 术语定义

| 术语 | 说明 |
|------|------|
| arXiv | 预印本论文服务器 |
| OpenAlex | 开放学术数据库 |
| LLM | 大语言模型（Large Language Model）|
| PDF | 便携式文档格式 |
| OCR | 光学字符识别 |

---

## 2. 概要设计

### 2.1 系统概述

#### 2.1.1 系统目标

构建一个自动化的论文Survey工具，实现以下核心功能：
1. **论文收集**：从AI顶会和机器人顶会自动收集论文标题
2. **信息获取**：通过API获取论文的详细信息（摘要、作者、PDF链接等）
3. **PDF处理**：下载论文PDF并转换为结构化文本
4. **智能分析**：使用LLM判断论文与具身智能领域的相关性

#### 2.1.2 系统边界

```
┌─────────────────────────────────────────────────────────────────┐
│                        系统边界                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    nona系统                              │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │   │
│  │  │论文收集  │ │信息获取  │ │PDF处理   │ │AI分析    │   │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↑                                   │
└──────────────────────────────┼───────────────────────────────────┘
                               │
         ┌─────────────────────┼─────────────────────┐
         │                     │                     │
    ┌────┴────┐          ┌────┴────┐          ┌────┴────┐
    │ arXiv   │          │OpenAlex │          │ LLM API │
    │ 会议网站 │          │   API   │          │(OpenAI) │
    └─────────┘          └─────────┘          └─────────┘
      外部数据源              外部API              外部服务
```

### 2.2 系统架构

#### 2.2.1 分层架构

系统采用四层架构设计：

```
┌─────────────────────────────────────────────────────────────────┐
│                       用户接口层 (Interface Layer)               │
│     scripts/collect_titles.py  scripts/fetch_paper_info.py      │
│     scripts/process_pdfs.py    scripts/analyze_papers.py        │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                       业务逻辑层 (Business Layer)                │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐│
│  │ collectors │  │  fetchers  │  │ processors │  │ analyzers  ││
│  │ 论文收集   │  │  信息获取  │  │  PDF处理   │  │  AI分析    ││
│  └────────────┘  └────────────┘  └────────────┘  └────────────┘│
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                       数据访问层 (Data Access Layer)             │
│                          database.py                             │
│                        (SQLite操作封装)                          │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                       基础设施层 (Infrastructure Layer)          │
│               config.py (配置管理) + 文件系统存储                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 2.2.2 模块依赖关系

```
                    ┌─────────────┐
                    │   config    │
                    └──────┬──────┘
                           │
           ┌───────────────┼───────────────┐
           │               │               │
           ↓               ↓               ↓
    ┌────────────┐  ┌────────────┐  ┌────────────┐
    │  database  │  │ collectors │  │  fetchers  │
    └──────┬─────┘  └────────────┘  └────────────┘
           │
           ↓
    ┌────────────┐  ┌────────────┐
    │ processors │  │  analyzers │
    └────────────┘  └────────────┘
           │               │
           └───────┬───────┘
                   ↓
            ┌────────────┐
            │  scripts   │
            └────────────┘
```

### 2.3 模块划分

| 模块名称 | 目录 | 职责描述 |
|---------|------|---------|
| 配置模块 | `config.py` | 管理全局配置、API密钥、路径等 |
| 数据库模块 | `database.py` | 提供SQLite数据库的CRUD操作 |
| 收集模块 | `collectors/` | 从各会议和arXiv收集论文标题 |
| 获取模块 | `fetchers/` | 通过API获取论文详细信息 |
| 处理模块 | `processors/` | PDF下载和文本转换 |
| 分析模块 | `analyzers/` | LLM相关性分析 |
| 脚本模块 | `scripts/` | 命令行执行脚本 |
| 测试模块 | `tests/` | 单元测试和集成测试 |

### 2.4 数据流设计

#### 2.4.1 主数据流

```
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│ 论文源  │───→│ 标题列表│───→│ 详细信息│───→│ PDF文本 │───→│ 分析结果│
│(会议/arXiv)│    │         │    │(arXiv ID)│    │         │    │(相关性) │
└─────────┘    └─────────┘    └─────────┘    └─────────┘    └─────────┘
     │              │              │              │              │
     ↓              ↓              ↓              ↓              ↓
┌─────────────────────────────────────────────────────────────────────┐
│                          SQLite 数据库                               │
│  papers表: pending → downloaded → processed → analyzed              │
└─────────────────────────────────────────────────────────────────────┘
```

#### 2.4.2 状态流转

```
pending ──────→ downloaded ──────→ processed ──────→ analyzed
   │                │                   │                │
   │                │                   │                │
   ↓                ↓                   ↓                ↓
仅有标题      获取arXiv ID/       PDF下载完成        LLM分析完成
             PDF URL/摘要          文本转换完成       生成相关性评分
```

### 2.5 技术选型

| 类别 | 技术选型 | 选型理由 |
|------|---------|---------|
| 编程语言 | Python 3.10+ | 丰富的科学计算和API库支持 |
| 数据库 | SQLite | 轻量级、无需独立部署、便于迁移 |
| PDF处理 | PyMuPDF (fitz) | 高性能PDF解析、支持文本提取 |
| HTTP客户端 | requests | 简洁易用、功能完善 |
| LLM API | OpenAI/Anthropic | 业界领先的语言模型能力 |
| 配置管理 | python-dotenv | 安全管理敏感配置 |
| 进度显示 | tqdm | 直观的进度条展示 |

---

## 3. 详细设计

### 3.1 配置模块 (config.py)

#### 3.1.1 模块职责

集中管理所有系统配置，包括：
- 项目路径配置
- API密钥管理
- LLM模型配置
- 相关性标签配置
- 日志和请求参数

#### 3.1.2 配置项清单

| 配置项 | 类型 | 默认值 | 说明 |
|-------|------|-------|------|
| PROJECT_ROOT | Path | 自动检测 | 项目根目录 |
| DATA_DIR | Path | data/ | 数据存储目录 |
| PDF_DIR | Path | data/pdfs/ | PDF文件目录 |
| TEXT_DIR | Path | data/texts/ | 文本文件目录 |
| DB_PATH | Path | data/papers.db | 数据库文件路径 |
| OPENAI_API_KEY | str | 环境变量 | OpenAI API密钥 |
| DEFAULT_LLM_PROVIDER | str | openai | 默认LLM提供商 |
| RELEVANCE_TAGS | List[str] | [...] | 相关性判断标签 |
| REQUEST_TIMEOUT | int | 30 | HTTP请求超时(秒) |
| MAX_PDF_SIZE_MB | int | 50 | PDF最大大小限制 |

#### 3.1.3 接口定义

```python
def get_api_key(provider: str = None) -> str:
    """获取指定提供商的API密钥"""
    
def get_model_name(provider: str = None) -> str:
    """获取指定提供商的默认模型名称"""
```

### 3.2 数据库模块 (database.py)

#### 3.2.1 模块职责

提供SQLite数据库的封装操作，包括：
- 数据库初始化和表创建
- 论文记录的CRUD操作
- 分析结果的存储和查询
- 统计信息查询

#### 3.2.2 类设计

```python
class Database:
    """数据库操作类"""
    
    def __init__(self, db_path: str):
        """初始化数据库连接并创建表"""
    
    # === 论文操作 ===
    def insert_paper(self, paper_data: Dict) -> bool
    def batch_insert_papers(self, papers: List[Dict]) -> int
    def get_paper_by_id(self, paper_id: str) -> Optional[Dict]
    def get_papers_by_status(self, status: str, limit: int = None) -> List[Dict]
    def update_paper_status(self, paper_id: str, status: str) -> bool
    def update_paper_info(self, paper_id: str, updates: Dict) -> bool
    
    # === 分析结果操作 ===
    def insert_analysis_result(self, result_data: Dict) -> bool
    def get_analysis_result(self, paper_id: str) -> Optional[Dict]
    def get_relevant_papers(self, min_score: float = 0.5) -> List[Dict]
    
    # === 统计操作 ===
    def get_statistics(self) -> Dict
```

#### 3.2.3 设计要点

- 使用 `INSERT OR IGNORE` 保证幂等性
- 使用索引优化查询性能
- 使用上下文管理器确保连接正确关闭

### 3.3 论文收集模块 (collectors/)

#### 3.3.1 模块结构

```
collectors/
├── __init__.py          # 模块导出
├── arxiv.py             # arXiv论文收集
├── neurips.py           # NeurIPS会议论文
├── iclr.py              # ICLR会议论文
├── icml.py              # ICML会议论文
├── corl.py              # CoRL会议论文
├── rss.py               # RSS会议论文
├── icra.py              # ICRA会议论文
└── iros.py              # IROS会议论文
```

#### 3.3.2 统一接口

每个收集器实现统一接口：

```python
def collect_xxx_papers(year: int, **kwargs) -> List[Dict[str, str]]:
    """
    收集论文标题
    
    Args:
        year: 会议/年份
        **kwargs: 额外参数
        
    Returns:
        论文列表: [{'title': str, 'url': str, 'source': str}]
    """
```

#### 3.3.3 arXiv收集器实现

```python
def collect_arxiv_papers(
    year: int = 2025,
    category: str = "cs.RO",
    max_results: int = 1000
) -> List[Dict[str, str]]:
    """
    使用arXiv API收集论文
    
    实现要点：
    1. 构建查询: cat:{category} AND submittedDate:[{start} TO {end}]
    2. 分批获取（每次最多1000条）
    3. 解析XML响应提取标题和URL
    """
```

### 3.4 信息获取模块 (fetchers/)

#### 3.4.1 模块结构

```
fetchers/
├── __init__.py          # 模块导出
└── paper_fetcher.py     # 论文信息获取器
```

#### 3.4.2 核心接口

```python
def fetch_paper_info(title: str, url: str = None) -> Optional[Dict]:
    """
    获取论文详细信息
    
    返回结构:
    {
        'title': str,
        'arxiv_id': str,
        'pdf_url': str,
        'authors': List[str],
        'abstract': str,
        'published_date': str
    }
    """

def batch_fetch_papers(
    papers: List[Dict],
    show_progress: bool = True
) -> List[Dict]:
    """批量获取论文信息"""
```

#### 3.4.3 搜索策略

```
┌─────────────┐
│  输入标题    │
└──────┬──────┘
       │
       ↓
┌─────────────┐     ┌─────────────┐
│ arXiv搜索   │────→│ OpenAlex搜索│
│ (精确+关键词)│     │             │
└──────┬──────┘     └──────┬──────┘
       │                   │
       └─────────┬─────────┘
                 ↓
         ┌─────────────┐
         │  合并去重    │
         └──────┬──────┘
                │
                ↓
         ┌─────────────┐
         │  精确匹配    │
         └──────┬──────┘
                │
                ↓
         ┌─────────────┐
         │  返回结果    │
         └─────────────┘
```

### 3.5 PDF处理模块 (processors/)

#### 3.5.1 模块结构

```
processors/
├── __init__.py          # 模块导出
├── pdf_downloader.py    # PDF下载器
└── pdf_to_text.py       # PDF转文本
```

#### 3.5.2 PDF下载器接口

```python
def download_pdf(
    pdf_url: str,
    save_path: Path,
    max_size_mb: int = 50
) -> bool:
    """
    下载PDF文件
    
    实现要点：
    1. 直接下载（非流式）避免卡住
    2. 检查文件大小限制
    3. 验证Content-Type
    4. 幂等性：已存在则跳过
    """
```

#### 3.5.3 PDF转文本接口

```python
def convert_pdf_to_text(
    pdf_path: Path,
    text_path: Path,
    extract_tables: bool = True,
    extract_formulas: bool = True
) -> bool:
    """
    将PDF转换为文本
    
    实现要点：
    1. 使用PyMuPDF逐页提取
    2. 文本清理和断行修复
    3. 可选的表格和公式提取
    4. 幂等性：已存在则跳过
    """
```

### 3.6 AI分析模块 (analyzers/)

#### 3.6.1 模块结构

```
analyzers/
├── __init__.py          # 模块导出
└── relevance_filter.py  # 相关性分析器
```

#### 3.6.2 核心接口

```python
def analyze_paper(
    paper_text: str,
    paper_info: Dict,
    provider: str = "openai",
    relevance_tags: List[str] = None
) -> Optional[Dict]:
    """
    分析论文相关性
    
    返回结构:
    {
        'is_relevant': bool,      # 是否相关
        'relevance_score': float, # 0.0-1.0
        'reasoning': str,         # 判断理由
        'summary': str            # 论文总结
    }
    """
```

#### 3.6.3 分析流程

```
┌─────────────┐
│ 论文文本    │
│ 论文信息    │
│ 相关性标签  │
└──────┬──────┘
       │
       ↓
┌─────────────┐
│ 构建提示词  │
│ (结构化格式) │
└──────┬──────┘
       │
       ↓
┌─────────────┐
│ 调用LLM API │
│(OpenAI/Claude)│
└──────┬──────┘
       │
       ↓
┌─────────────┐
│ 解析JSON响应 │
└──────┬──────┘
       │
       ↓
┌─────────────┐
│ 返回分析结果 │
└─────────────┘
```

### 3.7 脚本模块 (scripts/)

#### 3.7.1 模块结构

```
scripts/
├── __init__.py
├── collect_titles.py      # 论文标题收集脚本
├── fetch_paper_info.py    # 信息获取脚本
├── process_pdfs.py        # PDF处理脚本
├── analyze_papers.py      # AI分析脚本
├── clean_data.py          # 数据清理脚本
└── quick_verify.py        # 快速验证脚本
```

#### 3.7.2 命令行参数设计

| 脚本 | 参数 | 说明 |
|------|------|------|
| collect_titles.py | --source | 数据源（arxiv/neurips等） |
|                   | --year | 年份 |
| fetch_paper_info.py | --limit | 处理数量限制 |
|                     | --status | 要处理的状态 |
| process_pdfs.py | --limit | 处理数量限制 |
|                 | --skip-download | 跳过下载 |
|                 | --skip-convert | 跳过转换 |
| analyze_papers.py | --limit | 处理数量限制 |
|                   | --provider | LLM提供商 |

---

## 4. 接口设计

### 4.1 外部接口

#### 4.1.1 arXiv API

```
接口地址: http://export.arxiv.org/api/query
请求方式: GET
请求参数:
  - search_query: 查询语句
  - start: 起始位置
  - max_results: 最大结果数
响应格式: XML (Atom)
```

#### 4.1.2 OpenAlex API

```
接口地址: https://api.openalex.org/works
请求方式: GET
请求参数:
  - search: 搜索关键词
  - per-page: 每页数量
响应格式: JSON
```

#### 4.1.3 OpenAI API

```
接口地址: https://api.openai.com/v1/chat/completions
请求方式: POST
请求头: Authorization: Bearer {API_KEY}
请求体: JSON (messages, model, temperature等)
响应格式: JSON
```

### 4.2 内部接口

#### 4.2.1 数据传输对象

**PaperInfo**:
```python
{
    'id': str,              # 论文ID
    'title': str,           # 标题
    'arxiv_id': str,        # arXiv ID
    'pdf_url': str,         # PDF下载链接
    'authors': List[str],   # 作者列表
    'abstract': str,        # 摘要
    'published_date': str,  # 发布日期
    'source': str,          # 来源
    'status': str           # 状态
}
```

**AnalysisResult**:
```python
{
    'paper_id': str,        # 关联论文ID
    'is_relevant': bool,    # 是否相关
    'relevance_score': float, # 相关性分数
    'reasoning': str,       # 判断理由
    'summary': str          # 论文总结
}
```

---

## 5. 数据库设计

### 5.1 E-R图

```
┌─────────────────────────────────────────────────────────────┐
│                          papers                              │
├─────────────────────────────────────────────────────────────┤
│ PK │ id (TEXT)                                               │
│    │ title (TEXT) NOT NULL                                   │
│ UK │ arxiv_id (TEXT) UNIQUE                                  │
│    │ pdf_url (TEXT)                                          │
│    │ authors (TEXT) -- JSON格式                              │
│    │ abstract (TEXT)                                         │
│    │ published_date (TEXT)                                   │
│    │ source (TEXT)                                           │
│    │ status (TEXT) DEFAULT 'pending'                         │
│    │ created_at (TEXT) DEFAULT CURRENT_TIMESTAMP             │
└─────────────────────────────────────────────────────────────┘
                              │
                              │ 1:N
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                     analysis_results                         │
├─────────────────────────────────────────────────────────────┤
│ PK │ id (INTEGER) AUTOINCREMENT                              │
│ FK │ paper_id (TEXT) REFERENCES papers(id)                   │
│    │ is_relevant (INTEGER) DEFAULT 0                         │
│    │ relevance_score (REAL) DEFAULT 0.0                      │
│    │ reasoning (TEXT)                                        │
│    │ summary (TEXT)                                          │
│    │ analyzed_at (TEXT) DEFAULT CURRENT_TIMESTAMP            │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 表结构详细说明

#### papers表

| 字段名 | 类型 | 约束 | 说明 |
|-------|------|------|------|
| id | TEXT | PRIMARY KEY | 论文唯一标识（优先使用arxiv_id） |
| title | TEXT | NOT NULL | 论文标题 |
| arxiv_id | TEXT | UNIQUE | arXiv ID |
| pdf_url | TEXT | - | PDF下载链接 |
| authors | TEXT | - | 作者列表（JSON格式） |
| abstract | TEXT | - | 论文摘要 |
| published_date | TEXT | - | 发布日期 |
| source | TEXT | - | 来源（如NeurIPS2024） |
| status | TEXT | DEFAULT 'pending' | 处理状态 |
| created_at | TEXT | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

#### analysis_results表

| 字段名 | 类型 | 约束 | 说明 |
|-------|------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 自增主键 |
| paper_id | TEXT | FOREIGN KEY | 关联论文ID |
| is_relevant | INTEGER | DEFAULT 0 | 是否相关（0/1） |
| relevance_score | REAL | DEFAULT 0.0 | 相关性分数（0.0-1.0） |
| reasoning | TEXT | - | 判断理由 |
| summary | TEXT | - | 论文总结 |
| analyzed_at | TEXT | DEFAULT CURRENT_TIMESTAMP | 分析时间 |

### 5.3 索引设计

```sql
CREATE INDEX idx_papers_status ON papers(status);
CREATE INDEX idx_papers_source ON papers(source);
CREATE INDEX idx_analysis_paper_id ON analysis_results(paper_id);
```

---

## 6. 部署与运维

### 6.1 环境要求

- Python 3.10+
- 磁盘空间：至少10GB（用于存储PDF文件）
- 网络：能够访问arXiv、OpenAlex、OpenAI API

### 6.2 安装步骤

```bash
# 1. 克隆项目
git clone <repository-url>
cd nona

# 2. 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Linux/Mac
.\venv\Scripts\activate   # Windows

# 3. 安装依赖
pip install -r requirements.txt

# 4. 配置环境变量
cp env.example .env
# 编辑 .env 文件，填入API密钥
```

### 6.3 运行命令

```bash
# 完整工作流
python scripts/collect_titles.py --source arxiv --year 2024
python scripts/fetch_paper_info.py --limit 100
python scripts/process_pdfs.py --limit 50
python scripts/analyze_papers.py --limit 20 --provider openai
```

### 6.4 目录结构

```
nona/
├── config.py              # 配置管理
├── database.py            # 数据库操作
├── collectors/            # 论文收集模块
├── fetchers/              # 信息获取模块
├── processors/            # PDF处理模块
├── analyzers/             # AI分析模块
├── scripts/               # 执行脚本
├── tests/                 # 测试模块
├── data/                  # 数据目录
│   ├── papers.db         # SQLite数据库
│   ├── pdfs/             # PDF文件
│   └── texts/            # 文本文件
├── requirements.txt       # 依赖清单
├── env.example           # 环境变量示例
└── README.md             # 项目说明
```

---

## 7. 附录

### 7.1 错误码定义

| 错误类型 | 处理方式 |
|---------|---------|
| 网络超时 | 记录日志，跳过当前任务 |
| PDF下载失败 | 删除部分文件，标记失败 |
| LLM调用失败 | 返回None，不更新状态 |
| 数据库错误 | 记录日志，返回False |

### 7.2 日志规范

```python
# 日志级别使用
DEBUG   - 详细调试信息
INFO    - 正常操作记录（✓ 成功、进度等）
WARNING - 警告信息（✗ 跳过、找不到等）
ERROR   - 错误信息（异常、失败等）
```

### 7.3 测试覆盖

| 模块 | 测试文件 | 测试内容 |
|------|---------|---------|
| config | test_config.py | 配置加载、路径验证 |
| database | test_database.py | CRUD操作、事务 |
| collectors | test_collectors.py | 各来源收集功能 |
| fetchers | test_fetchers.py | API调用、解析 |
| processors | test_processors.py | 下载、转换 |
| analyzers | test_analyzers.py | LLM调用、结果解析 |

### 7.4 版本历史

| 版本 | 日期 | 主要变更 |
|------|------|---------|
| v1.0 | 2024-12 | 初始版本，实现核心功能 |

---

**文档结束**

*本文档由项目开发团队维护，如有更新请及时同步。*

