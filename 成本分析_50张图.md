# 50张图测试 - 时间成本和金钱成本分析

## 📊 任务规模

- **目标图片数**: 50张
- **每个原图生成prompt数**: 5个
- **每个prompt生成图片数**: 1张
- **总生成图片数**: 50 × 5 = 250张

## 💰 金钱成本分析

### API调用统计

#### 1. 图生文（Image-to-Text）
- **模型**: `google/gemini-2.5-flash`
- **调用次数**: 50次（每张原图1次）
- **定价**:
  - 输入: $0.30 / 1M tokens
  - 输出: $2.50 / 1M tokens

**Token估算**:
- **输入**: 每张图片约 1,290 tokens（1024×1024像素，base64编码）
- **输出**: 每个prompt约 200-300 tokens，5个prompt共约 1,000-1,500 tokens

**单次调用成本**:
- 输入成本: 1,290 tokens × $0.30 / 1M = **$0.000387**
- 输出成本: 1,250 tokens × $2.50 / 1M = **$0.003125**
- **单次总成本**: ~**$0.0035**

**50次总成本**: 50 × $0.0035 = **$0.175** ≈ **$0.18**

---

#### 2. 文生图（Text-to-Image）
- **模型**: `google/gemini-3-pro-image-preview`
- **调用次数**: 250次（50张原图 × 5个prompt）
- **定价**:
  - 输入: $2.00 / 1M tokens
  - 输出: $12.00 / 1M tokens（图片生成）

**Token估算**:
- **输入**: 每个prompt约 500-800 tokens（包含前置prompt）
- **输出**: 每张图片约 1,290 tokens（1024×1024像素）

**单次调用成本**:
- 输入成本: 650 tokens × $2.00 / 1M = **$0.0013**
- 输出成本: 1,290 tokens × $12.00 / 1M = **$0.01548**
- **单次总成本**: ~**$0.0168**

**250次总成本**: 250 × $0.0168 = **$4.20**

---

### 💵 总API成本估算

| 项目 | 调用次数 | 单次成本 | 总成本 |
|------|---------|---------|--------|
| 图生文 (gemini-2.5-flash) | 50 | $0.0035 | **$0.18** |
| 文生图 (gemini-3-pro-image-preview) | 250 | $0.0168 | **$4.20** |
| **总计** | 300 | - | **~$4.38** |

**实际成本范围**: **$4.00 - $5.50**（考虑token数波动和API响应差异）

---

## ⏱️ 时间成本分析

### 各步骤时间估算

#### 1. 论文收集阶段
- **操作**: 从arXiv API收集论文标题
- **论文数**: 约300篇（max-papers参数）
- **时间**: 5-10分钟
- **原因**: API调用快速，主要是网络延迟

#### 2. PDF下载阶段
- **操作**: 下载300篇论文的PDF
- **平均PDF大小**: 2-5 MB
- **网络速度假设**: 10 Mbps
- **时间估算**: 
  - 单篇下载: 2-5秒
  - 300篇: 10-25分钟（可并行，实际可能更快）

#### 3. 流程图提取阶段
- **操作**: 搜索关键词并提取图片
- **处理速度**: 每篇论文约5-10秒
- **成功提取率**: 约20-30%（50张图需要处理约200-250篇论文）
- **时间估算**: 20-40分钟

#### 4. Prompt生成阶段（图生文）
- **操作**: 50次API调用
- **单次API响应时间**: 5-15秒
- **时间估算**: 5-15分钟

#### 5. 图片生成阶段（文生图）
- **操作**: 250次API调用
- **单次API响应时间**: 10-30秒（图片生成较慢）
- **时间估算**: 40-125分钟（约1-2小时）

#### 6. 相似度评估阶段
- **操作**: 250次评估（SSIM + 特征匹配 + 深度学习）
- **单次评估时间**: 2-5秒
- **时间估算**: 10-20分钟

#### 7. 结果整理阶段
- **操作**: 文件复制、排名、生成报告
- **时间估算**: 2-5分钟

---

### ⏱️ 总时间成本估算

| 阶段 | 时间估算 | 备注 |
|------|---------|------|
| 论文收集 | 5-10分钟 | 快速 |
| PDF下载 | 10-25分钟 | 取决于网络 |
| 流程图提取 | 20-40分钟 | 本地处理 |
| Prompt生成 | 5-15分钟 | API调用 |
| **图片生成** | **40-125分钟** | **最耗时** |
| 相似度评估 | 10-20分钟 | 本地处理 |
| 结果整理 | 2-5分钟 | 快速 |
| **总计** | **1.5-3.5小时** | **约2-3小时** |

**实际运行时间**: **2-4小时**（考虑网络波动、API限流、失败重试等）

---

## 📈 优化建议

### 降低时间成本
1. **并行处理**: 
   - PDF下载可并行（已实现）
   - 图片生成可分批并行（需要修改代码）
   - 相似度评估可并行（需要修改代码）

2. **减少API等待时间**:
   - 使用异步请求
   - 实现请求队列和重试机制

### 降低金钱成本
1. **减少prompt数量**: 
   - 从5个降到3个，可节省40%成本
   - 成本: $4.38 → $2.63

2. **使用更便宜的模型**:
   - 图生文可考虑其他模型（但可能影响质量）
   - 文生图目前gemini-3-pro-image-preview是较优选择

3. **批量处理**:
   - 如果有多批任务，可以合并处理以优化资源利用

---

## 📝 总结

### 50张图测试成本概览

| 项目 | 估算值 |
|------|--------|
| **金钱成本** | **$4.00 - $5.50** |
| **时间成本** | **2-4小时** |
| **API调用数** | 300次 |
| **生成图片数** | 250张 |

### 主要成本来源
- **金钱**: 文生图API（$4.20，占96%）
- **时间**: 图片生成阶段（1-2小时，占50-60%）

### 性价比评估
- **单张原图成本**: ~$0.09（包含5张生成图）
- **单张生成图成本**: ~$0.017
- **每小时成本**: ~$1.50-2.00（包含时间和API）

---

**注意**: 以上估算基于理想情况，实际成本可能因以下因素波动：
- API响应时间变化
- 网络速度
- 图片大小和复杂度
- Token数实际使用量
- API限流和重试次数
